{"version":3,"file":"module.js","mappings":"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","sources":["webpack://ala-ela-panel/external amd \"@emotion/css\"","webpack://ala-ela-panel/external amd \"@grafana/ui\"","webpack://ala-ela-panel/external amd \"@grafana/runtime\"","webpack://ala-ela-panel/external amd \"@grafana/data\"","webpack://ala-ela-panel/external amd \"react\"","webpack://ala-ela-panel/webpack/bootstrap","webpack://ala-ela-panel/webpack/runtime/compat get default export","webpack://ala-ela-panel/webpack/runtime/define property getters","webpack://ala-ela-panel/webpack/runtime/hasOwnProperty shorthand","webpack://ala-ela-panel/webpack/runtime/make namespace object","webpack://ala-ela-panel/./types.ts","webpack://ala-ela-panel/./hooks/useFilterState.ts","webpack://ala-ela-panel/./components/FilterMenu.tsx","webpack://ala-ela-panel/./components/FilterItem.tsx","webpack://ala-ela-panel/./utils/sqlGenerator.ts","webpack://ala-ela-panel/./components/AlaElaPanel.tsx","webpack://ala-ela-panel/./module.ts"],"sourcesContent":["module.exports = __WEBPACK_EXTERNAL_MODULE__89__;","module.exports = __WEBPACK_EXTERNAL_MODULE__388__;","module.exports = __WEBPACK_EXTERNAL_MODULE__531__;","module.exports = __WEBPACK_EXTERNAL_MODULE__781__;","module.exports = __WEBPACK_EXTERNAL_MODULE__959__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/**\r\n * Filter mode: Include (=) or Exclude (!=)\r\n */\r\nexport type FilterMode = 'include' | 'exclude';\r\n\r\n/**\r\n * State of a single variable filter\r\n */\r\nexport interface FilterState {\r\n  /** Variable name */\r\n  name: string;\r\n  /** Whether the filter uses = (include) or != (exclude) */\r\n  mode: FilterMode;\r\n  /** Whether the filter is active (affects query) or inactive (bypassed) */\r\n  active: boolean;\r\n}\r\n\r\n/**\r\n * Map of variable names to their filter states\r\n */\r\nexport type FilterStateMap = Record<string, FilterState>;\r\n\r\n/**\r\n * Panel options stored in dashboard JSON\r\n */\r\nexport interface AlaElaPanelOptions {\r\n  /** Which variables to display (empty = all Query type variables) */\r\n  variableNames: string[];\r\n  /** Layout direction */\r\n  layout: 'horizontal' | 'vertical';\r\n  /** Show variable labels */\r\n  showLabels: boolean;\r\n  /** Compact mode */\r\n  compact: boolean;\r\n}\r\n\r\n/**\r\n * Default panel options\r\n */\r\nexport const defaultOptions: AlaElaPanelOptions = {\r\n  variableNames: [],\r\n  layout: 'horizontal',\r\n  showLabels: true,\r\n  compact: false,\r\n};\r\n\r\n/**\r\n * URL parameter prefixes for filter state\r\n */\r\nexport const URL_PARAM_PREFIX = {\r\n  MODE: '_fm-',      // Filter Mode: _fm-varname=include|exclude\r\n  ACTIVE: '_fa-',    // Filter Active: _fa-varname=true|false\r\n} as const;\r\n\r\n/**\r\n * SQL operators for each filter mode\r\n */\r\nexport const SQL_OPERATORS: Record<FilterMode, { single: string; multi: string }> = {\r\n  include: { single: '=', multi: 'IN' },\r\n  exclude: { single: '!=', multi: 'NOT IN' },\r\n};\r\n\r\n","import { useCallback, useEffect, useState } from 'react';\r\nimport { locationService } from '@grafana/runtime';\r\nimport { FilterMode, FilterState, FilterStateMap, URL_PARAM_PREFIX } from '../types';\r\n\r\n/**\r\n * Parse filter state from URL parameters\r\n */\r\nfunction parseFilterStateFromUrl(): FilterStateMap {\r\n  const params = new URLSearchParams(window.location.search);\r\n  const state: FilterStateMap = {};\r\n\r\n  params.forEach((value, key) => {\r\n    // Parse mode parameters: _fm-varname=include|exclude\r\n    if (key.startsWith(URL_PARAM_PREFIX.MODE)) {\r\n      const varName = key.slice(URL_PARAM_PREFIX.MODE.length);\r\n      if (!state[varName]) {\r\n        state[varName] = { name: varName, mode: 'include', active: true };\r\n      }\r\n      state[varName].mode = value === 'exclude' ? 'exclude' : 'include';\r\n    }\r\n    // Parse active parameters: _fa-varname=true|false\r\n    else if (key.startsWith(URL_PARAM_PREFIX.ACTIVE)) {\r\n      const varName = key.slice(URL_PARAM_PREFIX.ACTIVE.length);\r\n      if (!state[varName]) {\r\n        state[varName] = { name: varName, mode: 'include', active: true };\r\n      }\r\n      state[varName].active = value !== 'false';\r\n    }\r\n  });\r\n\r\n  return state;\r\n}\r\n\r\n/**\r\n * Update URL with filter state\r\n */\r\nfunction updateUrlWithState(filterState: FilterStateMap): void {\r\n  // Build ONLY the filter state parameters we want to update\r\n  const updates: Record<string, string | null> = {};\r\n\r\n  Object.values(filterState).forEach((filter) => {\r\n    const modeKey = `${URL_PARAM_PREFIX.MODE}${filter.name}`;\r\n    const activeKey = `${URL_PARAM_PREFIX.ACTIVE}${filter.name}`;\r\n\r\n    // Only add to URL if non-default values, otherwise remove\r\n    if (filter.mode !== 'include') {\r\n      updates[modeKey] = filter.mode;\r\n    } else {\r\n      updates[modeKey] = null; // null removes the parameter\r\n    }\r\n\r\n    if (!filter.active) {\r\n      updates[activeKey] = 'false';\r\n    } else {\r\n      updates[activeKey] = null; // null removes the parameter\r\n    }\r\n  });\r\n\r\n  // Update URL using locationService - this merges with existing params\r\n  locationService.partial(updates, true);\r\n}\r\n\r\n/**\r\n * Hook for managing filter state with URL persistence\r\n */\r\nexport function useFilterState() {\r\n  const [filterState, setFilterState] = useState<FilterStateMap>(() => parseFilterStateFromUrl());\r\n\r\n  // Sync with URL on mount and URL changes\r\n  useEffect(() => {\r\n    const handleUrlChange = () => {\r\n      setFilterState(parseFilterStateFromUrl());\r\n    };\r\n\r\n    window.addEventListener('popstate', handleUrlChange);\r\n    return () => window.removeEventListener('popstate', handleUrlChange);\r\n  }, []);\r\n\r\n  /**\r\n   * Get filter state for a variable, with defaults if not set\r\n   */\r\n  const getFilterState = useCallback(\r\n    (varName: string): FilterState => {\r\n      return (\r\n        filterState[varName] || {\r\n          name: varName,\r\n          mode: 'include' as FilterMode,\r\n          active: true,\r\n        }\r\n      );\r\n    },\r\n    [filterState]\r\n  );\r\n\r\n  /**\r\n   * Toggle filter mode between include and exclude\r\n   */\r\n  const toggleMode = useCallback(\r\n    (varName: string) => {\r\n      setFilterState((prev) => {\r\n        const current = prev[varName] || { name: varName, mode: 'include', active: true };\r\n        const newState = {\r\n          ...prev,\r\n          [varName]: {\r\n            ...current,\r\n            mode: current.mode === 'include' ? 'exclude' : 'include',\r\n          } as FilterState,\r\n        };\r\n        updateUrlWithState(newState);\r\n        return newState;\r\n      });\r\n    },\r\n    []\r\n  );\r\n\r\n  /**\r\n   * Toggle filter active state\r\n   */\r\n  const toggleActive = useCallback(\r\n    (varName: string) => {\r\n      setFilterState((prev) => {\r\n        const current = prev[varName] || { name: varName, mode: 'include', active: true };\r\n        const newState = {\r\n          ...prev,\r\n          [varName]: {\r\n            ...current,\r\n            active: !current.active,\r\n          } as FilterState,\r\n        };\r\n        updateUrlWithState(newState);\r\n        return newState;\r\n      });\r\n    },\r\n    []\r\n  );\r\n\r\n  /**\r\n   * Set filter mode directly\r\n   */\r\n  const setMode = useCallback(\r\n    (varName: string, mode: FilterMode) => {\r\n      setFilterState((prev) => {\r\n        const current = prev[varName] || { name: varName, mode: 'include', active: true };\r\n        const newState = {\r\n          ...prev,\r\n          [varName]: {\r\n            ...current,\r\n            mode,\r\n          } as FilterState,\r\n        };\r\n        updateUrlWithState(newState);\r\n        return newState;\r\n      });\r\n    },\r\n    []\r\n  );\r\n\r\n  /**\r\n   * Set filter active state directly\r\n   */\r\n  const setActive = useCallback(\r\n    (varName: string, active: boolean) => {\r\n      setFilterState((prev) => {\r\n        const current = prev[varName] || { name: varName, mode: 'include', active: true };\r\n        const newState = {\r\n          ...prev,\r\n          [varName]: {\r\n            ...current,\r\n            active,\r\n          } as FilterState,\r\n        };\r\n        updateUrlWithState(newState);\r\n        return newState;\r\n      });\r\n    },\r\n    []\r\n  );\r\n\r\n  /**\r\n   * Reset all filters to default state\r\n   */\r\n  const resetAll = useCallback(() => {\r\n    setFilterState({});\r\n    updateUrlWithState({});\r\n  }, []);\r\n\r\n  return {\r\n    filterState,\r\n    getFilterState,\r\n    toggleMode,\r\n    toggleActive,\r\n    setMode,\r\n    setActive,\r\n    resetAll,\r\n  };\r\n}\r\n\r\n","import React from 'react';\r\nimport { css } from '@emotion/css';\r\nimport { GrafanaTheme2 } from '@grafana/data';\r\nimport { useStyles2, RadioButtonGroup, Switch, Icon } from '@grafana/ui';\r\nimport { FilterMode, FilterState } from '../types';\r\n\r\ninterface FilterMenuProps {\r\n  filterState: FilterState;\r\n  onModeChange: (mode: FilterMode) => void;\r\n  onActiveChange: (active: boolean) => void;\r\n  onClose: () => void;\r\n}\r\n\r\nconst getStyles = (theme: GrafanaTheme2) => ({\r\n  menu: css`\r\n    position: absolute;\r\n    top: 100%;\r\n    left: 0;\r\n    z-index: 1000;\r\n    min-width: 200px;\r\n    background: ${theme.colors.background.primary};\r\n    border: 1px solid ${theme.colors.border.weak};\r\n    border-radius: ${theme.shape.radius.default};\r\n    box-shadow: ${theme.shadows.z3};\r\n    padding: ${theme.spacing(1.5)};\r\n    margin-top: ${theme.spacing(0.5)};\r\n  `,\r\n  section: css`\r\n    margin-bottom: ${theme.spacing(1.5)};\r\n    \r\n    &:last-child {\r\n      margin-bottom: 0;\r\n    }\r\n  `,\r\n  label: css`\r\n    display: block;\r\n    font-size: ${theme.typography.bodySmall.fontSize};\r\n    font-weight: ${theme.typography.fontWeightMedium};\r\n    color: ${theme.colors.text.secondary};\r\n    margin-bottom: ${theme.spacing(0.75)};\r\n  `,\r\n  modeOption: css`\r\n    display: flex;\r\n    align-items: center;\r\n    gap: ${theme.spacing(0.5)};\r\n  `,\r\n  activeRow: css`\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: space-between;\r\n    padding: ${theme.spacing(0.5)} 0;\r\n  `,\r\n  activeLabel: css`\r\n    display: flex;\r\n    align-items: center;\r\n    gap: ${theme.spacing(0.75)};\r\n    font-size: ${theme.typography.body.fontSize};\r\n    color: ${theme.colors.text.primary};\r\n  `,\r\n  divider: css`\r\n    height: 1px;\r\n    background: ${theme.colors.border.weak};\r\n    margin: ${theme.spacing(1)} 0;\r\n  `,\r\n});\r\n\r\nexport const FilterMenu: React.FC<FilterMenuProps> = ({\r\n  filterState,\r\n  onModeChange,\r\n  onActiveChange,\r\n  onClose,\r\n}) => {\r\n  const styles = useStyles2(getStyles);\r\n\r\n  const modeOptions = [\r\n    { label: '= Include', value: 'include' as FilterMode },\r\n    { label: '≠ Exclude', value: 'exclude' as FilterMode },\r\n  ];\r\n\r\n  const handleModeChange = (value: FilterMode) => {\r\n    onModeChange(value);\r\n  };\r\n\r\n  const handleActiveChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    onActiveChange(e.target.checked);\r\n  };\r\n\r\n  // Close on escape key\r\n  React.useEffect(() => {\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      if (e.key === 'Escape') {\r\n        onClose();\r\n      }\r\n    };\r\n    document.addEventListener('keydown', handleKeyDown);\r\n    return () => document.removeEventListener('keydown', handleKeyDown);\r\n  }, [onClose]);\r\n\r\n  // Close on outside click\r\n  React.useEffect(() => {\r\n    const handleClickOutside = (e: MouseEvent) => {\r\n      const target = e.target as HTMLElement;\r\n      if (!target.closest('[data-filter-menu]')) {\r\n        onClose();\r\n      }\r\n    };\r\n    // Delay to prevent immediate close\r\n    const timer = setTimeout(() => {\r\n      document.addEventListener('click', handleClickOutside);\r\n    }, 0);\r\n    return () => {\r\n      clearTimeout(timer);\r\n      document.removeEventListener('click', handleClickOutside);\r\n    };\r\n  }, [onClose]);\r\n\r\n  return (\r\n    <div className={styles.menu} data-filter-menu onClick={(e) => e.stopPropagation()}>\r\n      <div className={styles.section}>\r\n        <span className={styles.label}>Filter Mode</span>\r\n        <RadioButtonGroup\r\n          options={modeOptions}\r\n          value={filterState.mode}\r\n          onChange={handleModeChange}\r\n          size=\"sm\"\r\n          fullWidth\r\n        />\r\n      </div>\r\n\r\n      <div className={styles.divider} />\r\n\r\n      <div className={styles.section}>\r\n        <div className={styles.activeRow}>\r\n          <span className={styles.activeLabel}>\r\n            <Icon name={filterState.active ? 'check-circle' : 'circle'} />\r\n            Filter Active\r\n          </span>\r\n          <Switch value={filterState.active} onChange={handleActiveChange} />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n","import React, { useState, useCallback } from 'react';\nimport { css, cx } from '@emotion/css';\nimport { GrafanaTheme2, VariableModel } from '@grafana/data';\nimport { useStyles2, Tooltip, Icon } from '@grafana/ui';\nimport { FilterState, FilterMode } from '../types';\nimport { FilterMenu } from './FilterMenu';\n\ninterface FilterItemProps {\n  variable: VariableModel;\n  filterState: FilterState;\n  currentValues: string[];\n  showLabel: boolean;\n  compact: boolean;\n  onModeChange: (mode: FilterMode) => void;\n  onActiveChange: (active: boolean) => void;\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  container: css`\n    position: relative;\n    display: flex;\n    align-items: center;\n    gap: ${theme.spacing(0.5)};\n    padding: ${theme.spacing(0.5)} ${theme.spacing(1)};\n    background: ${theme.colors.background.secondary};\n    border: 1px solid ${theme.colors.border.weak};\n    border-radius: ${theme.shape.radius.default};\n    cursor: pointer;\n    transition: all 0.15s ease;\n    user-select: none;\n\n    &:hover {\n      background: ${theme.colors.action.hover};\n      border-color: ${theme.colors.border.medium};\n    }\n  `,\n  containerInactive: css`\n    opacity: 0.6;\n    background: ${theme.colors.background.primary};\n  `,\n  containerExclude: css`\n    border-color: ${theme.colors.warning.border};\n    background: ${theme.colors.warning.transparent};\n  `,\n  modeIndicator: css`\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    min-width: 20px;\n    height: 20px;\n    padding: 0 4px;\n    border-radius: ${theme.shape.radius.default};\n    font-size: 11px;\n    font-weight: bold;\n  `,\n  modeInclude: css`\n    background: ${theme.colors.success.transparent};\n    color: ${theme.colors.success.text};\n  `,\n  modeExclude: css`\n    background: ${theme.colors.warning.transparent};\n    color: ${theme.colors.warning.text};\n  `,\n  label: css`\n    font-size: ${theme.typography.body.fontSize};\n    font-weight: ${theme.typography.fontWeightMedium};\n    color: ${theme.colors.text.primary};\n    white-space: nowrap;\n  `,\n  labelInactive: css`\n    text-decoration: line-through;\n    color: ${theme.colors.text.disabled};\n  `,\n  separator: css`\n    color: ${theme.colors.text.secondary};\n    margin: 0 ${theme.spacing(0.25)};\n  `,\n  valuesWrapper: css`\n    display: flex;\n    align-items: center;\n    gap: ${theme.spacing(0.5)};\n    flex-wrap: wrap;\n    max-width: 300px;\n  `,\n  valueTag: css`\n    display: inline-flex;\n    align-items: center;\n    padding: ${theme.spacing(0.25)} ${theme.spacing(0.75)};\n    background: ${theme.colors.background.canvas};\n    border-radius: ${theme.shape.radius.pill};\n    font-size: ${theme.typography.bodySmall.fontSize};\n    color: ${theme.colors.text.primary};\n    max-width: 150px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n  `,\n  valueTagExclude: css`\n    background: ${theme.colors.warning.transparent};\n    color: ${theme.colors.warning.text};\n  `,\n  valueTagInactive: css`\n    background: ${theme.colors.background.secondary};\n    color: ${theme.colors.text.disabled};\n  `,\n  moreValues: css`\n    font-size: ${theme.typography.bodySmall.fontSize};\n    color: ${theme.colors.text.secondary};\n    font-style: italic;\n  `,\n  statusDot: css`\n    width: 8px;\n    height: 8px;\n    border-radius: 50%;\n    background: ${theme.colors.success.main};\n    margin-left: ${theme.spacing(0.5)};\n  `,\n  statusDotInactive: css`\n    background: ${theme.colors.text.disabled};\n  `,\n  menuIcon: css`\n    color: ${theme.colors.text.secondary};\n    margin-left: ${theme.spacing(0.5)};\n    transition: transform 0.15s ease;\n  `,\n  menuIconOpen: css`\n    transform: rotate(180deg);\n  `,\n  noValues: css`\n    font-size: ${theme.typography.bodySmall.fontSize};\n    color: ${theme.colors.text.disabled};\n    font-style: italic;\n  `,\n  compact: css`\n    padding: ${theme.spacing(0.25)} ${theme.spacing(0.75)};\n    gap: ${theme.spacing(0.25)};\n  `,\n  compactLabel: css`\n    font-size: ${theme.typography.bodySmall.fontSize};\n  `,\n});\n\nexport const FilterItem: React.FC<FilterItemProps> = ({\n  variable,\n  filterState,\n  currentValues,\n  showLabel,\n  compact,\n  onModeChange,\n  onActiveChange,\n}) => {\n  const styles = useStyles2(getStyles);\n  const [menuOpen, setMenuOpen] = useState(false);\n\n  const handleClick = useCallback(() => {\n    setMenuOpen((prev) => !prev);\n  }, []);\n\n  const handleMenuClose = useCallback(() => {\n    setMenuOpen(false);\n  }, []);\n\n  const displayLabel = (variable as any).label || variable.name;\n  const hasValues = currentValues.length > 0;\n  const maxDisplayValues = compact ? 2 : 3;\n  const displayValues = currentValues.slice(0, maxDisplayValues);\n  const remainingCount = currentValues.length - maxDisplayValues;\n\n  const getModeTooltip = () => {\n    const modeText = filterState.mode === 'include' ? 'Including' : 'Excluding';\n    const activeText = filterState.active ? 'Active' : 'Inactive';\n    return `${modeText} · ${activeText} · Click to configure`;\n  };\n\n  const containerClasses = cx(\n    styles.container,\n    compact && styles.compact,\n    !filterState.active && styles.containerInactive,\n    filterState.active && filterState.mode === 'exclude' && styles.containerExclude\n  );\n\n  const valueTagClasses = cx(\n    styles.valueTag,\n    filterState.mode === 'exclude' && filterState.active && styles.valueTagExclude,\n    !filterState.active && styles.valueTagInactive\n  );\n\n  return (\n    <Tooltip content={getModeTooltip()} placement=\"top\">\n      <div\n        className={containerClasses}\n        onClick={handleClick}\n        role=\"button\"\n        tabIndex={0}\n        onKeyDown={(e) => e.key === 'Enter' && handleClick()}\n      >\n        {/* Mode indicator */}\n        <span\n          className={cx(\n            styles.modeIndicator,\n            filterState.mode === 'include' ? styles.modeInclude : styles.modeExclude\n          )}\n        >\n          {filterState.mode === 'include' ? '=' : '≠'}\n        </span>\n\n        {/* Label */}\n        {showLabel && (\n          <>\n            <span\n              className={cx(\n                styles.label,\n                compact && styles.compactLabel,\n                !filterState.active && styles.labelInactive\n              )}\n            >\n              {displayLabel}\n            </span>\n            <span className={styles.separator}>:</span>\n          </>\n        )}\n\n        {/* Values display */}\n        <div className={styles.valuesWrapper}>\n          {hasValues ? (\n            <>\n              {displayValues.map((value, index) => (\n                <span key={index} className={valueTagClasses}>\n                  {value}\n                </span>\n              ))}\n              {remainingCount > 0 && (\n                <span className={styles.moreValues}>+{remainingCount} more</span>\n              )}\n            </>\n          ) : (\n            <span className={styles.noValues}>No selection</span>\n          )}\n        </div>\n\n        {/* Status dot */}\n        <span\n          className={cx(styles.statusDot, !filterState.active && styles.statusDotInactive)}\n        />\n\n        {/* Menu arrow */}\n        <Icon\n          name=\"angle-down\"\n          className={cx(styles.menuIcon, menuOpen && styles.menuIconOpen)}\n        />\n\n        {/* Filter menu */}\n        {menuOpen && (\n          <FilterMenu\n            filterState={filterState}\n            onModeChange={onModeChange}\n            onActiveChange={onActiveChange}\n            onClose={handleMenuClose}\n          />\n        )}\n      </div>\n    </Tooltip>\n  );\n};\n","import { FilterState, SQL_OPERATORS } from '../types';\r\n\r\n/**\r\n * Escape a value for safe use in ClickHouse SQL\r\n * Prevents SQL injection by escaping single quotes\r\n */\r\nexport function escapeClickHouseValue(value: string): string {\r\n  if (value === null || value === undefined) {\r\n    return 'NULL';\r\n  }\r\n  // Escape single quotes by doubling them (ClickHouse standard)\r\n  return value.replace(/'/g, \"''\");\r\n}\r\n\r\n/**\r\n * Check if a value represents \"all\" or empty selection\r\n */\r\nexport function isAllOrEmpty(value: string | string[] | undefined): boolean {\r\n  if (!value) {\r\n    return true;\r\n  }\r\n  if (Array.isArray(value)) {\r\n    if (value.length === 0) {\r\n      return true;\r\n    }\r\n    // Filter out special \"all\" values\r\n    const filtered = value.filter((v) => v && v !== '$__all' && v !== 'All' && v !== '');\r\n    return filtered.length === 0;\r\n  }\r\n  return value === '$__all' || value === 'All' || value === '';\r\n}\r\n\r\n/**\r\n * Normalize value to array format, handling all edge cases:\r\n * - undefined/null -> []\r\n * - single string -> [string] or split if comma-separated\r\n * - array with single comma-separated string -> split into multiple values\r\n * - array of values -> filter out special values\r\n */\r\nfunction normalizeToArray(value: string | string[] | undefined): string[] {\r\n  if (!value) {\r\n    return [];\r\n  }\r\n  \r\n  let values: string[] = [];\r\n  \r\n  if (Array.isArray(value)) {\r\n    // Flatten: if array contains comma-separated strings, split them\r\n    value.forEach((v) => {\r\n      if (v && typeof v === 'string') {\r\n        if (v.includes(',')) {\r\n          // Split comma-separated values within array elements\r\n          const split = v.split(',').map((s) => s.trim()).filter(Boolean);\r\n          values.push(...split);\r\n        } else if (v !== '$__all' && v !== 'All' && v !== '') {\r\n          values.push(v.trim());\r\n        }\r\n      }\r\n    });\r\n  } else if (typeof value === 'string') {\r\n    if (value === '$__all' || value === 'All' || value === '') {\r\n      return [];\r\n    }\r\n    if (value.includes(',')) {\r\n      // Split comma-separated string\r\n      values = value.split(',').map((v) => v.trim()).filter((v) => v && v !== '$__all' && v !== 'All');\r\n    } else {\r\n      values = [value.trim()];\r\n    }\r\n  }\r\n  \r\n  // Remove duplicates and filter out empty/special values\r\n  return [...new Set(values)].filter((v) => v && v !== '$__all' && v !== 'All');\r\n}\r\n\r\n/**\r\n * Generate a SQL WHERE clause fragment for a filter\r\n * \r\n * @param columnName - The column name (should match variable name)\r\n * @param value - The selected value(s)\r\n * @param filterState - Current filter state\r\n * @returns SQL clause string (e.g., \"AND server IN ('v1', 'v2')\") or empty string\r\n */\r\nexport function generateFilterClause(\r\n  columnName: string,\r\n  value: string | string[] | undefined,\r\n  filterState: FilterState\r\n): string {\r\n  // If filter is not active, return empty string\r\n  if (!filterState.active) {\r\n    return '';\r\n  }\r\n\r\n  // Normalize value to array\r\n  const values = normalizeToArray(value);\r\n  \r\n  // If no valid values, no filter needed\r\n  if (values.length === 0) {\r\n    return '';\r\n  }\r\n\r\n  const operators = SQL_OPERATORS[filterState.mode];\r\n  \r\n  if (values.length === 1) {\r\n    // Single value - use simple operator (= or !=)\r\n    const escapedValue = escapeClickHouseValue(values[0]);\r\n    return `AND ${columnName} ${operators.single} '${escapedValue}'`;\r\n  }\r\n  \r\n  // Multiple values - use IN or NOT IN\r\n  const escapedValues = values.map((v) => `'${escapeClickHouseValue(v)}'`).join(', ');\r\n  return `AND ${columnName} ${operators.multi} (${escapedValues})`;\r\n}\r\n\r\n/**\r\n * Generate all filter clauses for multiple variables\r\n * \r\n * @param filters - Map of column names to their values and states\r\n * @returns Combined SQL WHERE clause fragments\r\n */\r\nexport function generateAllFilterClauses(\r\n  filters: Array<{ columnName: string; value: string | string[] | undefined; state: FilterState }>\r\n): string {\r\n  return filters\r\n    .map(({ columnName, value, state }) => generateFilterClause(columnName, value, state))\r\n    .filter((clause) => clause !== '')\r\n    .join('\\n  ');\r\n}\r\n\r\n/**\r\n * Format filter state for display\r\n */\r\nexport function formatFilterDisplay(state: FilterState, value: string | string[]): string {\r\n  const prefix = state.mode === 'exclude' ? '≠ ' : '';\r\n  const valueStr = Array.isArray(value) ? value.join(', ') : value;\r\n  return `${prefix}${valueStr}`;\r\n}\r\n\r\n/**\r\n * Get CSS class for filter state visualization\r\n */\r\nexport function getFilterStateClass(state: FilterState): string {\r\n  const classes: string[] = [];\r\n  \r\n  if (!state.active) {\r\n    classes.push('filter-inactive');\r\n  }\r\n  \r\n  if (state.mode === 'exclude') {\r\n    classes.push('filter-exclude');\r\n  }\r\n  \r\n  return classes.join(' ');\r\n}\r\n","import React, { useMemo, useState, useEffect, useRef } from 'react';\r\nimport { css, cx } from '@emotion/css';\r\nimport { PanelProps, GrafanaTheme2, VariableModel } from '@grafana/data';\r\nimport { useStyles2, Alert, ClipboardButton } from '@grafana/ui';\r\nimport { getTemplateSrv, locationService } from '@grafana/runtime';\r\nimport { AlaElaPanelOptions } from '../types';\r\nimport { useFilterState } from '../hooks/useFilterState';\r\nimport { FilterItem } from './FilterItem';\r\nimport { generateFilterClause } from '../utils/sqlGenerator';\r\n\r\ninterface Props extends PanelProps<AlaElaPanelOptions> {}\r\n\r\nconst getStyles = (theme: GrafanaTheme2) => ({\r\n  container: css`\r\n    display: flex;\r\n    flex-direction: column;\r\n    height: 100%;\r\n    padding: ${theme.spacing(1)};\r\n    gap: ${theme.spacing(1)};\r\n  `,\r\n  filtersWrapper: css`\r\n    display: flex;\r\n    flex-wrap: wrap;\r\n    gap: ${theme.spacing(1.5)};\r\n  `,\r\n  filtersHorizontal: css`\r\n    flex-direction: row;\r\n    align-items: center;\r\n  `,\r\n  filtersVertical: css`\r\n    flex-direction: column;\r\n    align-items: flex-start;\r\n  `,\r\n  sqlSection: css`\r\n    flex: 1;\r\n    min-height: 0;\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: ${theme.spacing(0.5)};\r\n  `,\r\n  sqlHeader: css`\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: space-between;\r\n    padding: ${theme.spacing(0.5)} 0;\r\n  `,\r\n  sqlLabel: css`\r\n    font-size: ${theme.typography.bodySmall.fontSize};\r\n    font-weight: ${theme.typography.fontWeightMedium};\r\n    color: ${theme.colors.text.secondary};\r\n  `,\r\n  sqlPreview: css`\r\n    flex: 1;\r\n    min-height: 60px;\r\n    font-family: ${theme.typography.fontFamilyMonospace};\r\n    font-size: ${theme.typography.bodySmall.fontSize};\r\n    background: ${theme.colors.background.secondary};\r\n    border: 1px solid ${theme.colors.border.weak};\r\n    border-radius: ${theme.shape.radius.default};\r\n    padding: ${theme.spacing(1)};\r\n    overflow: auto;\r\n    white-space: pre-wrap;\r\n    word-break: break-all;\r\n  `,\r\n  noVariables: css`\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    height: 100%;\r\n    color: ${theme.colors.text.secondary};\r\n    font-style: italic;\r\n  `,\r\n  compact: css`\r\n    padding: ${theme.spacing(0.5)};\r\n    gap: ${theme.spacing(0.5)};\r\n  `,\r\n});\r\n\r\n// Helper to normalize values to array\r\nfunction normalizeToArray(input: any): string[] {\r\n  if (!input) {\r\n    return [];\r\n  }\r\n  \r\n  if (Array.isArray(input)) {\r\n    return input\r\n      .filter((v) => v && v !== '$__all' && v !== 'All')\r\n      .map((v) => String(v).trim())\r\n      .filter(Boolean);\r\n  }\r\n  \r\n  if (typeof input === 'string') {\r\n    if (input === '$__all' || input === 'All' || input === '') {\r\n      return [];\r\n    }\r\n    if (input.includes(',')) {\r\n      return input\r\n        .split(',')\r\n        .map((v) => v.trim())\r\n        .filter((v) => v && v !== '$__all' && v !== 'All');\r\n    }\r\n    return [input.trim()];\r\n  }\r\n  \r\n  return [];\r\n}\r\n\r\n// Parse ClickHouse format {value1,value2,value3} to array\r\nfunction parseClickHouseFormat(value: string): string[] {\r\n  if (!value) {\r\n    return [];\r\n  }\r\n  \r\n  const trimmed = value.trim();\r\n  \r\n  // Check if it's in ClickHouse array format {val1,val2}\r\n  if (trimmed.startsWith('{') && trimmed.endsWith('}')) {\r\n    const inner = trimmed.slice(1, -1); // Remove { and }\r\n    const values = inner.split(',').map(v => v.trim()).filter(Boolean);\r\n    console.log(`[ClickHouse Parser] Input: \"${trimmed}\" → Output:`, values);\r\n    return values;\r\n  }\r\n  \r\n  return [];\r\n}\r\n\r\n// Get variable values from Grafana with detailed logging\r\nfunction getVariableValues(variables: VariableModel[]): Record<string, string[]> {\r\n  const values: Record<string, string[]> = {};\r\n  const templateSrv = getTemplateSrv();\r\n  const timestamp = new Date().toISOString().split('T')[1].slice(0, 12);\r\n\r\n  variables.forEach((variable) => {\r\n    const varAny = variable as any;\r\n    let extractedValues: string[] = [];\r\n    let source = '';\r\n    \r\n    // Method 1: Template replacement (has multi-values in ClickHouse format!)\r\n    const replaced = templateSrv.replace(`$${variable.name}`);\r\n    if (replaced && replaced !== `$${variable.name}`) {\r\n      // Try parsing ClickHouse format {val1,val2}\r\n      const clickhouseValues = parseClickHouseFormat(replaced);\r\n      if (clickhouseValues.length > 0) {\r\n        extractedValues = clickhouseValues;\r\n        source = 'template-clickhouse';\r\n      } else {\r\n        extractedValues = normalizeToArray(replaced);\r\n        source = 'template';\r\n      }\r\n    }\r\n    \r\n    // Method 2: URL parameters (fallback for single values)\r\n    if (extractedValues.length === 0) {\r\n      const urlParams = new URLSearchParams(window.location.search);\r\n      const urlValue = urlParams.get(`var-${variable.name}`);\r\n      if (urlValue) {\r\n        extractedValues = normalizeToArray(urlValue);\r\n        source = 'URL';\r\n      }\r\n    }\r\n    \r\n    // Method 3: current.value (might be stale)\r\n    if (extractedValues.length === 0 && varAny.current?.value !== undefined) {\r\n      extractedValues = normalizeToArray(varAny.current.value);\r\n      source = 'current';\r\n    }\r\n    \r\n    // Method 4: selected options\r\n    if (extractedValues.length === 0 && varAny.options) {\r\n      const selected = varAny.options\r\n        .filter((opt: any) => opt.selected)\r\n        .map((opt: any) => opt.value);\r\n      if (selected.length > 0) {\r\n        extractedValues = normalizeToArray(selected);\r\n        source = 'options';\r\n      }\r\n    }\r\n    \r\n    console.log(`[${timestamp}] ${variable.name}: ${JSON.stringify(extractedValues)} (from ${source})`);\r\n    values[variable.name] = extractedValues;\r\n  });\r\n  \r\n  return values;\r\n}\r\n\r\nexport const AlaElaPanel: React.FC<Props> = ({ options, width, height, data, timeRange, eventBus }) => {\r\n  const styles = useStyles2(getStyles);\r\n  const { getFilterState, setMode, setActive } = useFilterState();\r\n  const templateSrv = getTemplateSrv();\r\n\r\n  // Get all dashboard variables\r\n  const allVariables = useMemo(() => {\r\n    return templateSrv.getVariables() as VariableModel[];\r\n  }, [templateSrv]);\r\n\r\n  // Filter to display variables\r\n  const displayVariables = useMemo(() => {\r\n    if (options.variableNames && options.variableNames.length > 0) {\r\n      const varNames = typeof options.variableNames === 'string'\r\n        ? (options.variableNames as string).split(',').map((n) => n.trim()).filter(Boolean)\r\n        : options.variableNames;\r\n      \r\n      return allVariables.filter((v) => varNames.includes(v.name));\r\n    }\r\n    return allVariables.filter((v) => (v as any).type === 'query');\r\n  }, [allVariables, options.variableNames]);\r\n\r\n  // State for variable values\r\n  const [variableValues, setVariableValues] = useState<Record<string, string[]>>({});\r\n\r\n  // Update function - always creates new object to force re-render\r\n  const updateValues = useRef(() => {\r\n    const newValues = getVariableValues(displayVariables);\r\n    // Always create new object reference to ensure React detects change\r\n    setVariableValues({ ...newValues });\r\n  });\r\n\r\n  // Update the ref when displayVariables changes\r\n  useEffect(() => {\r\n    updateValues.current = () => {\r\n      const newValues = getVariableValues(displayVariables);\r\n      setVariableValues({ ...newValues });\r\n    };\r\n  }, [displayVariables]);\r\n\r\n  // Very fast polling - 50ms\r\n  useEffect(() => {\r\n    // Initial update\r\n    updateValues.current();\r\n    \r\n    // Poll every 50ms\r\n    const intervalId = setInterval(() => {\r\n      updateValues.current();\r\n    }, 50);\r\n    \r\n    return () => clearInterval(intervalId);\r\n  }, []);\r\n\r\n  // Also update on location/URL changes\r\n  useEffect(() => {\r\n    const unsubscribe = locationService.getHistory().listen(() => {\r\n      setTimeout(() => updateValues.current(), 10);\r\n    });\r\n    return unsubscribe;\r\n  }, []);\r\n\r\n  // Update on data/time range changes\r\n  useEffect(() => {\r\n    updateValues.current();\r\n  }, [data.series.length, timeRange]);\r\n\r\n  // Generate SQL preview\r\n  const sqlPreview = useMemo(() => {\r\n    if (displayVariables.length === 0) {\r\n      return '-- No variables configured';\r\n    }\r\n\r\n    const clauses = displayVariables.map((variable) => {\r\n      const state = getFilterState(variable.name);\r\n      const values = variableValues[variable.name] || [];\r\n      return generateFilterClause(variable.name, values, state);\r\n    });\r\n\r\n    const nonEmptyClauses = clauses.filter((c) => c !== '');\r\n    \r\n    if (nonEmptyClauses.length === 0) {\r\n      return '-- No active filters';\r\n    }\r\n\r\n    return `-- Generated WHERE clauses:\\n${nonEmptyClauses.join('\\n')}`;\r\n  }, [displayVariables, getFilterState, variableValues]);\r\n\r\n  // Copy-friendly SQL\r\n  const copyableSql = useMemo(() => {\r\n    const clauses = displayVariables.map((variable) => {\r\n      const state = getFilterState(variable.name);\r\n      const values = variableValues[variable.name] || [];\r\n      return generateFilterClause(variable.name, values, state);\r\n    });\r\n\r\n    return clauses.filter((c) => c !== '').join('\\n');\r\n  }, [displayVariables, getFilterState, variableValues]);\r\n\r\n  // Automatically update the alaela_sql variable in URL\r\n  useEffect(() => {\r\n    const sqlClauses = displayVariables.map((variable) => {\r\n      const state = getFilterState(variable.name);\r\n      const values = variableValues[variable.name] || [];\r\n      return generateFilterClause(variable.name, values, state);\r\n    }).filter((c) => c !== '').join('\\n');\r\n\r\n    // Update URL parameter (which Grafana treats as a variable value)\r\n    // For Textbox/Custom variables, updating the URL param updates the variable\r\n    const currentParams = new URLSearchParams(window.location.search);\r\n    const currentSql = currentParams.get('var-alaela_sql');\r\n    \r\n    // Only update if the SQL actually changed to avoid unnecessary URL updates\r\n    if (currentSql !== sqlClauses) {\r\n      console.log('[AlaEla] Updating alaela_sql variable:', sqlClauses);\r\n      \r\n      // For empty SQL, set to a comment instead of null to keep the variable defined\r\n      const valueToSet = sqlClauses || '-- No active filters';\r\n      \r\n      locationService.partial({\r\n        'var-alaela_sql': valueToSet,\r\n      }, true);\r\n    }\r\n  }, [displayVariables, getFilterState, variableValues]);\r\n\r\n  if (displayVariables.length === 0) {\r\n    return (\r\n      <div className={cx(styles.container, options.compact && styles.compact)}>\r\n        <Alert title=\"No variables found\" severity=\"info\">\r\n          Add Query-type variables to your dashboard, or specify variable names in the panel options.\r\n        </Alert>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Debug info - show what we're reading from Grafana\r\n  const debugInfo = displayVariables.map((v) => {\r\n    const varAny = v as any;\r\n    const urlParams = new URLSearchParams(window.location.search);\r\n    const urlValue = urlParams.get(`var-${v.name}`);\r\n    const templateValue = templateSrv.replace(`$${v.name}`);\r\n    const currentValue = varAny.current?.value;\r\n    const panelValue = variableValues[v.name];\r\n    \r\n    return {\r\n      name: v.name,\r\n      url: urlValue,\r\n      template: templateValue !== `$${v.name}` ? templateValue : 'N/A',\r\n      current: JSON.stringify(currentValue),\r\n      panel: JSON.stringify(panelValue)\r\n    };\r\n  });\r\n\r\n  return (\r\n    <div className={cx(styles.container, options.compact && styles.compact)}>\r\n      {/* HUGE DEBUG PANEL - VERSION 2.0 - IMPOSSIBLE TO MISS */}\r\n      <div style={{ \r\n        fontSize: '16px', \r\n        background: 'red', \r\n        color: 'white',\r\n        padding: '20px', \r\n        border: '5px solid yellow',\r\n        borderRadius: '4px',\r\n        marginBottom: '8px',\r\n        fontFamily: 'monospace',\r\n        fontWeight: 'bold',\r\n        textAlign: 'center'\r\n      }}>\r\n        🔴 DEBUG PANEL v2.0 🔴\r\n        <br/>\r\n        Time: {new Date().toLocaleTimeString()}\r\n        <br/>\r\n        Variables: {displayVariables.length}\r\n      </div>\r\n      \r\n      {/* Detailed debug info */}\r\n      <div style={{ \r\n        fontSize: '11px', \r\n        background: '#2a2a2a', \r\n        padding: '8px', \r\n        borderRadius: '4px',\r\n        marginBottom: '8px',\r\n        fontFamily: 'monospace',\r\n        maxHeight: '150px',\r\n        overflow: 'auto'\r\n      }}>\r\n        <div style={{ color: '#ffa500', fontWeight: 'bold', marginBottom: '4px' }}>\r\n          Detailed Debug - Last update: {new Date().toLocaleTimeString()}\r\n        </div>\r\n        {debugInfo.map(info => (\r\n          <div key={info.name} style={{ color: '#aaa', marginBottom: '4px' }}>\r\n            <span style={{ color: '#4fc3f7' }}>{info.name}:</span>\r\n            <br/>\r\n            &nbsp;&nbsp;URL: {info.url || 'null'} | \r\n            Template: {info.template} | \r\n            Current: {info.current} | \r\n            <span style={{ color: info.panel === JSON.stringify(info.url?.split(',')) ? '#4caf50' : '#f44336' }}>\r\n              Panel: {info.panel}\r\n            </span>\r\n          </div>\r\n        ))}\r\n      </div>\r\n      \r\n      <div\r\n        className={cx(\r\n          styles.filtersWrapper,\r\n          options.layout === 'horizontal' ? styles.filtersHorizontal : styles.filtersVertical\r\n        )}\r\n      >\r\n        {displayVariables.map((variable) => {\r\n          const state = getFilterState(variable.name);\r\n          const values = variableValues[variable.name] || [];\r\n          return (\r\n            <FilterItem\r\n              key={variable.name}\r\n              variable={variable}\r\n              filterState={state}\r\n              currentValues={values}\r\n              showLabel={options.showLabels}\r\n              compact={options.compact}\r\n              onModeChange={(mode) => setMode(variable.name, mode)}\r\n              onActiveChange={(active) => setActive(variable.name, active)}\r\n            />\r\n          );\r\n        })}\r\n      </div>\r\n\r\n      {height > 150 && (\r\n        <div className={styles.sqlSection}>\r\n          <div className={styles.sqlHeader}>\r\n            <span className={styles.sqlLabel}>Generated SQL Clauses</span>\r\n            {copyableSql && (\r\n              <ClipboardButton\r\n                getText={() => copyableSql}\r\n                size=\"sm\"\r\n                variant=\"secondary\"\r\n                icon=\"copy\"\r\n              >\r\n                Copy\r\n              </ClipboardButton>\r\n            )}\r\n          </div>\r\n          <pre className={styles.sqlPreview}>{sqlPreview}</pre>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n","import { PanelPlugin } from '@grafana/data';\r\nimport { AlaElaPanel } from './components/AlaElaPanel';\r\nimport { AlaElaPanelOptions, defaultOptions } from './types';\r\n\r\nexport const plugin = new PanelPlugin<AlaElaPanelOptions>(AlaElaPanel)\r\n  .setPanelOptions((builder) => {\r\n    builder\r\n      .addTextInput({\r\n        path: 'variableNames',\r\n        name: 'Variable Names',\r\n        description: 'Comma-separated list of variable names to display. Leave empty to show all Query variables.',\r\n        defaultValue: '',\r\n        settings: {\r\n          placeholder: 'server, region, status',\r\n        },\r\n      })\r\n      .addRadio({\r\n        path: 'layout',\r\n        name: 'Layout',\r\n        description: 'How to arrange the variable filters',\r\n        defaultValue: defaultOptions.layout,\r\n        settings: {\r\n          options: [\r\n            { value: 'horizontal', label: 'Horizontal' },\r\n            { value: 'vertical', label: 'Vertical' },\r\n          ],\r\n        },\r\n      })\r\n      .addBooleanSwitch({\r\n        path: 'showLabels',\r\n        name: 'Show Labels',\r\n        description: 'Display variable labels/names',\r\n        defaultValue: defaultOptions.showLabels,\r\n      })\r\n      .addBooleanSwitch({\r\n        path: 'compact',\r\n        name: 'Compact Mode',\r\n        description: 'Reduce padding and spacing',\r\n        defaultValue: defaultOptions.compact,\r\n      });\r\n  })\r\n  .setNoPadding();\r\n\r\n"],"names":["module","exports","__WEBPACK_EXTERNAL_MODULE__89__","__WEBPACK_EXTERNAL_MODULE__388__","__WEBPACK_EXTERNAL_MODULE__531__","__WEBPACK_EXTERNAL_MODULE__781__","__WEBPACK_EXTERNAL_MODULE__959__","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","n","getter","__esModule","d","a","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","URL_PARAM_PREFIX","SQL_OPERATORS","include","single","multi","exclude","parseFilterStateFromUrl","params","URLSearchParams","window","location","search","state","forEach","startsWith","varName","slice","name","mode","active","updateUrlWithState","filterState","updates","values","filter","modeKey","activeKey","locationService","partial","getStyles","theme","menu","css","colors","background","primary","border","weak","shape","radius","default","shadows","z3","spacing","section","label","typography","bodySmall","fontSize","fontWeightMedium","text","secondary","modeOption","activeRow","activeLabel","body","divider","FilterMenu","onModeChange","onActiveChange","onClose","styles","useStyles2","React","handleKeyDown","e","document","addEventListener","removeEventListener","handleClickOutside","target","closest","timer","setTimeout","clearTimeout","div","className","data-filter-menu","onClick","stopPropagation","span","RadioButtonGroup","options","onChange","size","fullWidth","Icon","Switch","checked","container","action","hover","medium","containerInactive","containerExclude","warning","transparent","modeIndicator","modeInclude","success","modeExclude","labelInactive","disabled","separator","valuesWrapper","valueTag","canvas","pill","valueTagExclude","valueTagInactive","moreValues","statusDot","main","statusDotInactive","menuIcon","menuIconOpen","noValues","compact","compactLabel","FilterItem","variable","currentValues","showLabel","menuOpen","setMenuOpen","useState","handleClick","useCallback","prev","handleMenuClose","displayLabel","hasValues","length","maxDisplayValues","displayValues","remainingCount","containerClasses","cx","valueTagClasses","Tooltip","content","placement","role","tabIndex","onKeyDown","map","index","escapeClickHouseValue","replace","generateFilterClause","columnName","Array","isArray","v","includes","split","s","trim","Boolean","push","Set","normalizeToArray","operators","escapedValue","escapedValues","join","filtersWrapper","filtersHorizontal","filtersVertical","sqlSection","sqlHeader","sqlLabel","sqlPreview","fontFamilyMonospace","noVariables","input","String","getVariableValues","variables","templateSrv","getTemplateSrv","timestamp","Date","toISOString","varAny","extractedValues","source","replaced","clickhouseValues","trimmed","endsWith","console","log","parseClickHouseFormat","urlValue","current","selected","opt","JSON","stringify","plugin","PanelPlugin","width","height","data","timeRange","eventBus","getFilterState","setMode","setActive","setFilterState","useEffect","handleUrlChange","toggleMode","newState","toggleActive","resetAll","useFilterState","allVariables","useMemo","getVariables","displayVariables","variableNames","varNames","type","variableValues","setVariableValues","updateValues","useRef","newValues","intervalId","setInterval","clearInterval","getHistory","listen","series","nonEmptyClauses","c","copyableSql","sqlClauses","valueToSet","Alert","title","severity","debugInfo","templateValue","currentValue","panelValue","url","template","panel","style","color","padding","borderRadius","marginBottom","fontFamily","fontWeight","textAlign","br","toLocaleTimeString","maxHeight","overflow","info","layout","showLabels","ClipboardButton","getText","variant","icon","pre","setPanelOptions","builder","addTextInput","path","description","defaultValue","settings","placeholder","addRadio","addBooleanSwitch","setNoPadding"],"ignoreList":[],"sourceRoot":""}